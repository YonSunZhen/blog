<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel='stylesheet' href='/stylesheets/public.css' />
  <link rel='stylesheet' href='/stylesheets/admin.css' />
  <link rel="stylesheet" href="/javascripts/layui/css/layui.css">
  <title>用户管理</title>
</head>
<body>
  <table id="manager" lay-filter="manager"></table>
  <script src="/javascripts/layui/layui.js"></script>
  <script type="text/html" id="bar">
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
  </script>
  <script>
    layui.use(['table','jquery','layer'], function(){
      var table = layui.table;
      var $ = layui.jquery;
      var layer = layui.layer;
      //第一个实例
      table.render({
        elem: '#manager',
        width:1400,
        height: 540,
        url: '/index/getManagersAllData' ,//数据接口
        page: true ,//开启分页
        cols: [[ //表头
          {type:'checkbox',fixed:'left'},
          {field:'',title:'序号',type:'numbers',width:80},
          {field: 'userName', title: '用户名', width:110},
          {field: 'state', title: '状态', width:80,templet:function(d){
            if(d.state === 1){
              return '通过';
            }else{
              return '未通过';
            }
          }},
          {field: 'mobile', title: '手机号', width:130} ,
          {field: 'createDate', title: '创建时间', width: 180},
          {field: 'loginDate', title: '登录时间', width: 120, sort: true},
          {field: 'lastLoginDate', title: '上次登录时间', width: 120, sort: true},
          {field: 'loginTimes', title: '登录次数', width: 100},
          {field: 'right', title: '操作',align:'center', width: 150, toolbar:'#bar'}
        ]]
      });

      table.on('tool(manager)',function(obj){
        let data = obj.data;//获取当前行所有数据
        let id = data.id;//获取选中行的id
        let layEvent = obj.event;//获取点击的是哪个操作按钮
        let tr = obj.tr;//获取当前行tr的DOM对象
        if(layEvent === 'del'){
          console.log(obj);
          $.ajax({
            type:'POST',
            url:'/index/delManagersOneData',
            data:{'id':id},
            success:function(data){
              if(data === "success"){
                layer.confirm('已成功删除！',function(index){
                  obj.del();//删除对应行（tr）的DOM结构，并更新缓存
                  layer.close(index);//关闭对话框
                })
              }else{
                alert("删除失败");
              }
            }
          })
        }else if(layEvent === 'edit'){
          layer.open({
            type:0,
            title:'编辑用户',
            btn:['提交','取消'],
            //按钮的回调操作
            btn1:function(index, layero){
              var haha = $("#username1").val();
              console.log(haha);
            },
            btn2:function(index, layero){
              console.log("777");
            },
            content:'<div class="login-item" id="edit"><span class="user-icon"></span><input class="form-text" type="text" placeholder="请输入用户名"  id="username1"></div>'
          })
        }
      })
    })
  </script>
</body>
</html>